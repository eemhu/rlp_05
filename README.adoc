[#_rlp_05]
= RLP_05

Golang RELP library, allows the use of the RELP protocol in Golang

Tested on Go v1.19.

== Basic usage

Initializes a RELP connection, and verifies each batch.
[,go]
----
func main() {
relpSess := RelpConnection{}
	relpSess.Init()

	batch := RelpBatch{}
	batch.Init()
	batch.PutRequest(&RelpFrameTX{
		RelpFrame{
			cmd:        "syslog",
			dataLength: len([]byte("HelloWorld")),
			data:       []byte("HelloWorld"),
		},
	})

    retry(&relpSess)

	notDone := true
	for notDone {
		commitErr := relpSess.Commit(&batch)
		if commitErr != nil {
			log.Printf("Error committing batch: '%v'\n", commitErr.Error())
		}

		if !batch.VerifyTransactionAll() {
			batch.RetryAllFailed()
			retry(&relpSess)
		} else {
			notDone = false
		}
	}

	relpSess.Disconnect()

	fmt.Println(">>DONE<<")
	// await for input, so the program doesn't exit
	a := 0.0
	fmt.Scanf("%f", &a)
}

func retry(relpSess *RelpConnection) {
	relpSess.TearDown()
	var cSuccess bool
	var cErr error
	cSuccess, cErr = relpSess.Connect("127.0.0.1", 1601)
	for !cSuccess || cErr != nil {
		relpSess.TearDown()
		time.Sleep(5 * time.Second)
		cSuccess, cErr = relpSess.Connect("127.0.0.1", 1601)
	}
}
----

== TODO

|===
|Feature |Status

|Basic RELP connection
|Can connect, receive and send messages

|Error handling (timeouts)
|Errors if ACK not received within 30sec, error reaches commit(&batch) call.
Use batch.verifyTransactionAll() and .retryAllFailed() to check transactions after each batch's commit() call.

|Unit testing
|Implemented with external rlp_03 server jar

|Documentation
|Comments included. Should godoc be generated?

|Dependencies
|Testing dependent on included rlp_03 demo server jar
|===

